
var data = {"mx140-gobernadores": {"@presidenciamx": 184, "productores": 176, "inauguraci\u00f3n": 142, "#morelos": 530, "estudiantes": 156, "#puebla": 421, "#quintanaroo": 194, "motivo": 214, "#m\u00e9xico": 227, "@goboax": 146, "inversi\u00f3n": 369, "felicitaci\u00f3n": 139, "nacional": 371, "#yucat\u00e1n": 194, "@epn": 290, "inauguramos": 186, "justicia": 157, "educaci\u00f3n": 202, "seguridad": 217, "familias": 207, "#oaxaca": 142, "salud": 186, "entregamos": 158, "2015": 196, "@gobyucatan": 240, "j\u00f3venes": 174, "acciones": 187, "desarrollo": 179, "desde": 194, "cultura": 146}, "mx140-pri": {"@ccq_pri": 63, "#pri": 449, "camacho": 40, "#puebla": 384, "#consolidandoliderazgos": 31, "c\u00e9sar": 25, "@ralbores": 38, "chapo": 26, "electoral": 26, "nacional": 25, "fuga": 25, "sobre": 21, "@epn": 35, "2015": 36, "@icadep": 21, "@pri_nacional": 25, "@enc_icadep": 26, "chiapas": 26, "@manuelherrera1": 44, "partido": 22, "#19dejulio": 25, "#rojosdecoraz\u00f3n": 36, "j\u00f3venes": 29, "l\u00edder": 25, "#chiapas": 23, "@gdeloya": 36, "@cristina_diaz_s": 30, "puebla": 49, "#votapri": 34, "social": 22}, "puebla140": {"ciudad": 181, "@sintesisweb": 241, "#lom\u00e1sle\u00eddo": 272, "#pueblaesmidestino": 215, "#pueblamidestino": 220, "#m\u00e9xico": 197, "#opini\u00f3n": 179, "serd\u00e1n": 188, "electoral": 174, "contra": 266, "#internacional": 216, "carrera": 192, "sobre": 307, "2015": 341, "moreno": 257, "@pueblaayto": 171, "@reporpue11": 179, "valle": 266, "#particicpa": 306, "@tonygali": 178, "hasta": 247, "chalchihuapan": 172, "desde": 230, "tras": 260, "ser\u00e1": 173, "buap": 188}, "mx140-prd": {"@senbarbosa": 47, "@manceramiguelmx": 40, "#prd": 38, "@mario_delgado1": 44, "@dolores_pl": 45, "#paraestarbien": 59, "@riospiterjaguar": 43, "federal": 29, "presidencia": 36, "sobre": 84, "#prd_df": 74, "@prdchisoficial": 58, "prensa": 34, "@gracielasaldana": 30, "@silvano_a": 40, "municipal": 58, "chiapas": 68, "@e_cuauhtemocmx": 29, "@navarretecarlos": 70, "@prensaeloi": 29, "@angelicadelap": 75, "comisi\u00f3n": 41, "#fotos": 29, "#chiapas": 38, "#prdcercadeti": 54, "@prdmexico": 127, "#cdmx": 88, "ciudadan\u00eda": 47, "#votaprd": 67, "@raulflorescoy": 145}, "mx140-ejecutivo": {"#ahorrarenerg\u00eda": 295, "cuesti\u00f3n": 296, "atenci\u00f3n": 370, "orientaci\u00f3n": 328, "h\u00e1bitos": 298, "#nosmuevelapaz": 319, "#d\u00edadel\u00e1rbol": 245, "#to2015": 334, "ante": 183, "estos": 335, "@nosmuevelapaz": 184, "#m\u00e9xico": 633, "#veracruz": 174, "nacional": 402, "sobre": 425, "@epn": 365, "diferencia": 300, "siguiendo": 296, "pago": 171, "2015": 425, "sistema": 208, "usuarios": 294, "@conabio": 214, "acciones": 243, "@gobrep": 334, "cuidado": 163, "@sinhambremx": 192, "convocatoria": 168, "social": 228, "#cfetips": 295}, "mx140-pan": {"@marianagc": 21, "#avisosparroquiales": 22, "guzm\u00e1n": 23, "@pancho_burquez_": 48, "dirigencia": 24, "#pan": 226, "@javier_corral": 80, "ricardo": 31, "reynoso": 20, "#larebeliondelasbases": 34, "@ricardoanayac": 34, "chapo": 52, "nacional": 47, "contra": 23, "fuga": 35, "@gabycuevas": 24, "sobre": 64, "@epn": 25, "@marcelotorresc": 20, "@jlozanoa": 48, "corrupci\u00f3n": 21, "seguridad": 25, "@laura_rojas_": 29, "@lopezbrito_": 26, "comisi\u00f3n": 20, "anaya": 59, "@oligarza3": 22, "corral": 29, "@yoxjavier": 35, "desde": 23}, "all": {"#ent\u00e9rate": 495, "trump": 367, "#pri": 508, "pide": 289, "#video": 297, "guzm\u00e1n": 307, "#pan": 298, "#puebla": 1184, "ante": 387, "#m\u00e9xico": 505, "#opini\u00f3n": 315, "federal": 305, "nacional": 580, "contra": 660, "fuga": 714, "sobre": 1234, "@epn": 704, "2015": 634, "@enfoquenoticias": 478, "seguridad": 462, "grecia": 293, "desarrollo": 273, "#envivo": 279, "puebla": 704, "hasta": 353, "chapo": 978, "desde": 535, "tras": 353, "ser\u00e1": 276, "social": 271}, "mx140-opinion": {"#ent\u00e9rate": 683, "maestros": 246, "cnte": 251, "#video": 306, "griego": 284, "ante": 274, "#opini\u00f3n": 355, "chapo": 529, "#grecia": 293, "contra": 665, "@adela_micha": 447, "grecia": 744, "refer\u00e9ndum": 316, "@enfoquenoticias": 783, "c\u00f3mo": 267, "francisco": 346, "seguridad": 266, "#ahora": 257, "papa": 451, "#envivo": 281, "#quenosetepase": 286, "meses": 264}, "mx140-senadores": {"#laordenfueabatir": 133, "@marianagc": 237, "permanente": 131, "@silvia_garza": 180, "mucho": 151, "ciudad": 116, "#puebla": 161, "@javier_corral": 248, "#m\u00e9xico": 161, "siempre": 125, "nacional": 238, "contra": 127, "@epigmenioibarra": 201, "sobre": 537, "@epn": 146, "porque": 221, "#paraepnpidocastigo": 134, "@larioshector": 122, "#oaxaca": 128, "@senadoresprd": 166, "espero": 120, "comisi\u00f3n": 338, "@accionnacional": 149, "#chiapas": 160, "ayotzinapafueelejercito": 174, "niperdonniolvido": 174, "elecci\u00f3n": 167, "desde": 204, "@hectoryunes": 179, "@senadomexicano": 266}, "mx140-diputados": {"@martibatres": 190, "@presidenciamx": 117, "@manceramiguelmx": 128, "mucho": 151, "#pan": 176, "@javier_corral": 234, "@conchitadiez": 140, "@ricardoanayac": 131, "@landyberzunza": 159, "federal": 142, "nacional": 288, "contra": 168, "fuga": 133, "sobre": 297, "@epn": 300, "@mx_diputados": 125, "mujeres": 229, "#oaxaca": 148, "siempre": 123, "@zuleymahuidobro": 110, "@juan1250mexico": 116, "comisi\u00f3n": 161, "@accionnacional": 112, "mayores": 117, "@ferbelaunzaran": 749, "@ricardomeb": 235, "hasta": 111, "@yoxjavier": 161, "desde": 190}};
/*var data = $.getJSON( "data/pack.json", function( data ) {
    console.log("success...")
    console.log (data.puebla140)
    });
*/
var diameter = 650;
var newcat = "all";

// create chart svg space
var svg = d3.select('#chart').append('svg')
	.attr('width', diameter+100)
	.attr('height', diameter)
    .attr('margin-top', 200);

// define the omnitooltip
var tooltip = d3.select("body")
    .append("div")
    .attr('id', 'tooltip')
    .style("position", "absolute")
    .style("z-index", "10")
    .style("visibility", "hidden")
    .style("color", "white")
    .style("padding", "8px")
    .style("background-color", "rgba(0, 0, 0, 0.75)")
    .style("border-radius", "6px")
    .style("font", "2em SF Movie Poster")
    .text(":)");

function compa(a, b) {
  return (Math.random()-0.5);
}

// invoke pack layout and misterious filtering
var bubble = d3.layout.pack()
    .sort(compa)
	.size([diameter, diameter])
	.padding(4) // padding between adjacent circles
	.value(function(d) {return d.size;}); // new data will be loaded to bubble layout


function drawBubbles(newcat){
    var bop = svg.selectAll('g')
        .data({}, function(d) {return d;});
        bop.exit().remove();


    var nodes = bubble.nodes(processData(data[newcat]))
	    .filter(function(d) { return !d.children; }); // filter out the outer bubble 
    console.log(data[newcat]);

    //create groups for each, append circle and text
    var vis = svg.selectAll('g')
	    .data(nodes, function(d) {return d.name;})
	    .enter().append('g')
        .attr('transform', function(d) { return 'translate(' + d.x + ',' + d.y + ')'; });

    vis.append('circle') 
	    //.attr('r',0)
        .attr('value', function(d) { return 1.05*d.r+((Math.random()-0.5) * 20); }) //this is the random traslaper
	    .attr('class', function(d) { return sizeToClass(d.value); })
        .attr('opacity', 0)
        .on("mouseover", function(d) {
            tooltip.text(d.name + ": " + d.value);
            tooltip.style("visibility", "visible");
        })
        .on("mousemove", function() {
            return tooltip.style("top", (d3.event.pageY-20)+"px").style("left",(d3.event.pageX+10)+"px");
        })
        .on("mouseout", function(){return tooltip.style("visibility", "hidden");
        });

    vis.append("text")
        .attr("dy", ".3em")
        .attr('class', function(d) { return sizeToClass(d.value); })
        .attr('opacity', 0)
        .style("text-anchor", "middle")
        .style("stroke", "5px")
        .style("fill", "#FFFFFF")
        .style("pointer-events", "none")
        .text(function(d) { return d.name; });
    

    //$('circle').animate().toggle().toggle();
    $('circle').each(function() {
        var nr = $(this).attr('value');
        $(this).animate({
            r: nr,
            opacity: 0.75
            }, {
                duration: Math.random()*1800,
                step: function(now){
                        // others are cool and go throu this
                        $(this).attr('r', now);
                        // firefox is stupid and need this
                        $(this).attr('r', nr);
                    }
            });
    });

    $('text').animate({
            opacity: 1,
    }, Math.random()*2000);


    };

var state1 = true;
var state2 = true;
var state3 = true;

// complementary functions
function processData(pata) {
	var obj = pata;
	var newDataSet = []; 
    //console.log(pata);
	for(var prop in obj) {
		newDataSet.push({name: prop, className: prop.toLowerCase(), size: obj[prop]});
	}
	console.log("[:P] Nom nom,"+obj);
    //console.log(newDataSet);
	return {children: newDataSet};
}


function changeCategory() {
    newcat = document.getElementById("categoria").value;
    console.log('[Updating to]: ' + newcat);
    drawBubbles(newcat);
    }



function sizeToClass(ra){
    if (ra < 100) return "burb1";
    if (ra>=100 && ra < 200) return "burb2";
    if (ra>=200 && ra < 300) return "burb3";
    if (ra>=300 && ra < 400) return "burb4";
    if (ra>=400 && ra < 500) return "burb5";
    if (ra>=500) return "burb6";
    else return "burb0";
}

var main = function (){
    
    drawBubbles(newcat);


    $('#colorstrip').colorstrip({
        minInterval: 6000,
        maxInterval: 18000,
        minWidth: 20,
        maxWidth: 50,
        opacity: 0.3,
        colors: ['#f90', '#39c', '#c00', '#090', '#c3f', '#007', '#69f']
    });

    $(".nav li").on ('click', function(e){
        e.preventDefault();
        //$(this).tab('show');
        var categ = $(this).attr('value');
        console.log('[Updating to]: ' + categ);
        drawBubbles(categ);
    });

    $("#toggle-slide-button-1").on('click',function () {
        if (state1){
            $('#navBtn-a').animate({right: 40}, 500);
            $('#navBtn-a').animate({width: 230}, 500);
            $("#panela" ).position({
                my: "center-50 top+2",
                at: "center top",
                of: "#navBtn-a"
            });
            $( "#panela" ).animate( {opacity: 1}, 1500);

        } else {
            $( "#panela" ).animate({opacity: 0}, 100);
            $('#navBtn-a').animate({width: 70}, 500);
            $('#navBtn-a').animate({right: -120}, 500);
            $("#panela" ).position({
                my: "left-30",
                at: "left",
                of: "#navBtn-a"
            });
            $( "#panela" ).animate({opacity: 0}, 500);

        }
        state1 = !state1;  
    });
    
    $("#toggle-slide-button-2").on('click',function () {
        if (state2){
            $('#navBtn-b').animate({right: 40}, 500);
            $('#navBtn-b').animate({width: 230}, 500);
            $("#panelb" ).position({
                my: "center-50",
                at: "center",
                of: "#navBtn-b"
            });
            $( "#panelb" ).animate( {opacity: 1}, 1500);


        } else {
            $( "#panelb" ).animate({opacity: 0}, 50);
            $('#navBtn-b').animate({width: 70}, 500);
            $('#navBtn-b').animate({right: -120}, 500);
            $("#panelb" ).position({
                my: "left-30",
                at: "left",
                of: "#navBtn-b"
            });
        }
        state2 = !state2;  
    });

    $("#toggle-slide-button-3").on('click', function () {
        if (state3){
            $('#navBtn-c').animate({right: 40}, 500);
            $('#navBtn-c').animate({width: 230}, 500);

        } else {
            $('#navBtn-c').animate({width: 70}, 500);
            $('#navBtn-c').animate({right: -120}, 500);
        }
        state3 = !state3;  
    });
}


$(document).ready(main);